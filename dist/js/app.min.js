function KNN(){}function Application(){}function Canvas(){}function ClasssToColorMapper(){}function DistanceCalculator(){}function Dot(){}function DotBuilder(){}function DotEventHandler(){}function DotUpdater(){}function GUI(){}function init(){var t=(getNodeById("overlay"),new Application);t.init(),overlay.style.visibility="hidden"}function getComputedStyleAttr(t,s){var e=getNodeById(t),i=getComputedStyle(e)[s];return i&&i.indexOf("px")>-1&&(i=parseInt(i.replace("px"),10)),i}function getNodeById(t){return document.getElementById(t)}function range(t,s,e){var i=[];if("undefined"==typeof e&&(e=1),t&&s&&e)for(;s>=t;)i.push(t),t+=e;return i}KNN.prototype.init=function(t){this.k=t.k,this.distanceCalculator=t.distanceCalculator},KNN.prototype.run=function(t){"number"==typeof this.k&&(this.k<=0||(this.k=parseInt(this.k,10),this.knownDots=t.knownDots,this.unknownDots=t.unknownDots,this.knownDots&&this.unknownDots&&(this.knownDots.length<1||this.unknownDots.length<1||(this.knownDots.length<this.k&&(this.k=this.knownDots.length),this._setUpCycle()&&window.requestAnimationFrame(this._cycle.bind(this))))))},KNN.prototype._setUpCycle=function(){return this.currentDot=fjs.first("x => true",this.unknownDots),this.currentDot?(this.unknownDots=fjs.select("x => x.id !== "+this.currentDot.id,this.unknownDots),!0):!1},KNN.prototype._cycle=function(){this._distances(),this._sortDistances(),this._kNearestNeighbors(),this._classsByVote(),this.unknownDots.length>0&&this._setUpCycle()&&window.requestAnimationFrame(this._cycle.bind(this))},KNN.prototype._distances=function(){this.currentDot.distances=fjs.map(function(t){return[this.distanceCalculator.distance(t,this.currentDot),t]}.bind(this),this.knownDots)},KNN.prototype._sortDistances=function(){this.currentDot.distances.sort(function(t,s){return t[0]-s[0]})},KNN.prototype._kNearestNeighbors=function(){this.currentDot.kNearestNeighbors=this.currentDot.distances.slice(0,this.k)},KNN.prototype._classsByVote=function(){var t=null,s=null,e={};fjs.each(function(t){var s=t[1].classs;e[s]=e[s]||0,e[s]+=1}.bind(this),this.currentDot.kNearestNeighbors),s=fjs.first("x => true",fjs.best(function(t,s){return t[1]>s[1]}.bind(this),fjs.toArray(e))),t=this.currentDot,PubSub.publish("classified",{dot:t,classs:s})},Application.prototype.init=function(t){var s=window.innerWidth,e=window.innerHeight;this.classsToColorMapper=new ClasssToColorMapper,this.distanceCalculator=new DistanceCalculator,this.distanceCalculator.init({method:"euclidean"}),this.kNN=new KNN,this.kNN.init({k:5,distanceCalculator:this.distanceCalculator}),this.canvas=new Canvas,this.canvas.init({canvasId:"canvas",bounds:{top:0,bottom:e,left:0,right:s},sidebar:{color:getComputedStyleAttr("baseSidebar","color"),width:getComputedStyleAttr("baseSidebar","width")},baseDotsParams:[{classs:"purple",color:this.classsToColorMapper.map("purple")},{classs:"orange",color:this.classsToColorMapper.map("orange")},{classs:"yellow",color:this.classsToColorMapper.map("yellow")},{classs:"green",color:this.classsToColorMapper.map("green")},{classs:"blue",color:this.classsToColorMapper.map("blue")},{classs:null,color:this.classsToColorMapper.map("gray")}]}),window.requestAnimationFrame(this.update.bind(this)),window.addEventListener("resize",this.reset.bind(this)),this.pubSubTokens=[["classified",PubSub.subscribe("classified",this.dotClassified.bind(this))]],this.gui=new GUI,this.gui.init({application:this})},Application.prototype.update=function(){var t=null;this.now=Date.now(),this.then||(this.then=this.now),t=(this.now-this.then)/1e3,this.canvas.update(t)===!0?this.requestAnimationFrameId=window.requestAnimationFrame(this.update.bind(this)):window.cancelAnimationFrame(this.requestAnimationFrameId),this.then=this.now},Application.prototype.reset=function(t){this.canvas.reset(),this.gui.reset(),PubSub.clearAllSubscriptions(),window.removeEventListener("resize",this.reset),this.init()},Application.prototype.knownDots=function(){return fjs.select("x => x.classs !== null",this.canvas.dots)},Application.prototype.unknownDots=function(){return fjs.select("x => x.classs === null",this.canvas.dots)},Application.prototype.runKNN=function(){this.kNN.run({knownDots:this.knownDots(),unknownDots:this.unknownDots()})},Application.prototype.dotClassified=function(t,s){s.color=this.classsToColorMapper.map(s.classs),this.canvas.updateDot(s)},Canvas.prototype.init=function(t){this.initParams=t,this.bounds=t.bounds,this.canvasId=t.canvasId,this.canvasNode=getNodeById(this.canvasId),this.canvasNode.width=window.innerWidth,this.canvasNode.height=window.innerHeight,this.canvasNode.style.width=window.innerWidth+"px",this.canvasNode.style.height=window.innerHeight+"px",this.pubSubTokens=[],this.stage=new createjs.Stage(this.canvasId),this.baseDots=[],this.dots=[],this.dotColors=t.dotColors,this.dotBuilder=new DotBuilder,this.dotBuilder.init({stage:this.stage}),this.dotUpdater=new DotUpdater,this.dotEventHandler=new DotEventHandler,this.dotEventHandler.init({canvas:this}),this.addSidebar(t.sidebar),this.buildBaseDots(t.baseDotsParams),this.dotEventHandler.enableDragDropBaseDots(this.baseDots),this.delta=0,this.ready=!0},Canvas.prototype.addSidebar=function(t){this.sidebar={},this.sidebar.width=t.width,this.sidebar.height=this.bounds.bottom-this.bounds.top,this.sidebar.color=t.color;var s=new createjs.Shape;return s.graphics.beginFill(this.sidebar.color).drawRect(0,0,this.sidebar.width,this.sidebar.height),s.x=0,s.y=0,this.sidebar.view=this.stage.addChild(s),this.sidebar},Canvas.prototype.buildBaseDots=function(t){fjs.each(function(t,s){t.x=50,t.y=50+10*s+getComputedStyleAttr("baseDot","height")*s,this.addDot("baseDots",t)}.bind(this),t)},Canvas.prototype.addDot=function(t,s){var e=this.dotBuilder.buildDot(s);return this[t].push(e),e},Canvas.prototype.removeDot=function(t,s){var e=s.dot;return this[t]=fjs.select("x => x.id !== "+e.id,this[t]),e},Canvas.prototype.updateDot=function(t){this.dotUpdater.update(t)},Canvas.prototype.update=function(t){return this.ready===!1?!1:(this.delta=t,this.stage.update(),!0)},Canvas.prototype.reset=function(){this.ready=!1,this.baseDots=[],this.dots=[],this.dotBuilder=void 0,this.dotUpdater=void 0,this.dotEventHandler=void 0,this.stage.removeAllChildren(),this.stage.removeAllEventListeners(),this.stage=void 0,fjs.each(function(t){PubSub.unsubscribe(t[1])}.bind(this),this.pubSubTokens)},ClasssToColorMapper.prototype.map=function(t){return getComputedStyleAttr(t.toLowerCase()+"Dot","color")},DistanceCalculator.prototype.init=function(t){this.initParams=t,this.method=t.method},DistanceCalculator.prototype.distance=function(t,s){if(!t||!s)throw"DistanceCalculator - ERROR! a or b undefined";if(!t.features||!s.features)throw"DistanceCalculator - ERROR! a.features or b.features undefined";if(!fjs.isArray(t.features)||!fjs.isArray(s.features))throw"DistanceCalculator - ERROR! a.features or b.features not array";if(t.features.length!==s.features.length)throw"DistanceCalculator - ERROR! a.features != b.features";return this[this.method](t,s)},DistanceCalculator.prototype.euclidean=function(t,s){var e=fjs.map(function(t){return(t[0]-t[1])*(t[0]-t[1])},this._zip(t,s));return Math.sqrt(fjs.reduce(function(t,s){return t+s},e))},DistanceCalculator.prototype._zip=function(t,s){var e=[];return fjs.each(function(i,o){e.push([t.features[o],s.features[o]])},t.features),e},Dot.prototype.init=function(t){this.initParams=t,this.id=t.id,this.x=t.x,this.y=t.y,this.z=t.z,this.features=t.features||[],this.classs=t.classs,this.color=t.color,this.view=t.view},Dot.prototype.WIDTH=function(){var t=getComputedStyleAttr("baseDot","width");return t}(),Dot.prototype.HEIGHT=function(){var t=getComputedStyleAttr("baseDot","height");return t}(),DotBuilder.prototype.init=function(t){return this.stage=t.stage,this},DotBuilder.prototype.buildDot=function(t){var s=new Dot,e=null;return t.WIDTH=s.WIDTH,t.HEIGHT=s.HEIGHT,e=this.buildDisplayObject(t,"drawEllipse"),t.view=e,t.id=e.id,t.features=[e.x,e.y],s.init(t),e.dot=s,s},DotBuilder.prototype.buildDisplayObject=function(t,s){var e=new createjs.Shape;return e.graphics.beginFill(t.color)[s](0,0,t.WIDTH,t.HEIGHT),e.x=t.x,e.y=t.y,e.regX=t.WIDTH/2,e.regY=t.HEIGHT/2,this.stage.addChild(e)},DotEventHandler.prototype.init=function(t){this.canvas=t.canvas},DotEventHandler.prototype.pressMoveEventHandler=function(t,s){var e=t.target,i=e.dot;this.canvas.updateDot({dot:i,x:t.rawX,y:t.rawY})},DotEventHandler.prototype.mouseDownEventHandler=function(t,s){var e=t.target,i=e.dot,o=i.initParams,n=this.canvas.addDot("baseDots",o);this.canvas.removeDot("baseDots",{dot:i}),this.canvas.dots.push(i),n.view.on("mousedown",this.mouseDownEventHandler.bind(this),null,!1),n.view.on("pressmove",this.pressMoveEventHandler.bind(this),null,!1)},DotEventHandler.prototype.enableDragDropBaseDots=function(t){fjs.each(function(t){t.view.on("pressmove",this.pressMoveEventHandler.bind(this),null,!1),t.view.on("mousedown",this.mouseDownEventHandler.bind(this),null,!1)}.bind(this),t)},DotUpdater.prototype.update=function(t){var s=t.dot;if(s)return fjs.each(function(e){t[e]&&(s[e]=t[e])}.bind(this),["id","x","y","z","classs","color","view"]),s.view&&this.updateView(t),this.updateFeatures(t),s},DotUpdater.prototype.updateFeatures=function(t){var s=t.dot;if(s)return s.features=[],fjs.each(function(t){s[t]&&s.features.push(s[t])}.bind(this),["x","y","z"]),s.features},DotUpdater.prototype.updateView=function(t){var s=t.dot;if(s&&s.view)return fjs.each(function(e){t[e]&&(s.view[e]=t[e],s[e]=t[e])}.bind(this),["x","y"]),t.color&&this.updateViewColor(t),s.view},DotUpdater.prototype.updateViewColor=function(t){var s=t.dot,e=t.color;s&&s.view&&e&&(s.color=e,s.view.graphics._fill.style=e)},GUI.prototype.init=function(t){var s=t.application;this.datGUI=new dat.GUI,this.datGUI.add(s.kNN,"k").min(1).max(20).step(1).listen(),this.datGUI.add(s,"runKNN"),this.datGUI.add(s,"reset")},GUI.prototype.reset=function(){this.datGUI.destroy(),this.datGUI=void 0};